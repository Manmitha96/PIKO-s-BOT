const { cmd } = require("../command");
const axios = require("axios");

cmd(
  {
    pattern: "imggen",
    alias: ["imagegen", "aiimage", "draw"],
    react: "ğŸ¨",
    desc: "Generate AI image from a text prompt",
    category: "ai",
    filename: __filename,
  },
  async (robin, mek, m, { from, q, reply }) => {
    try {
      if (!q) return reply("*Please enter a prompt to generate an image.* ğŸ¨\n\nExample: imggen a cyberpunk samurai in Tokyo");

      reply("ğŸ§  *Generating image...*\nThis may take a few seconds...");

      // Call Lexica API (no key needed)
      const res = await axios.get(`https://lexica.art/api/v1/search?q=${encodeURIComponent(q)}`);
      const results = res.data.images;

      if (!results || results.length === 0) {
        return reply("âŒ No image found for that prompt. Try a different one!");
      }

      const img = results[Math.floor(Math.random() * results.length)].srcSmall;

      await robin.sendMessage(
        from,
        {
          image: { url: img },
          caption: `ğŸ–¼ï¸ *Prompt:* ${q}\nğŸ”— *Generated by Lexica AI*`,
        },
        { quoted: mek }
      );
    } catch (e) {
      console.error("ImageGen error:", e);
      reply(`âŒ *Failed to generate image.*\nReason: ${e.message || e}`);
    }
  }
);
